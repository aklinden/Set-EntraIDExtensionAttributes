# Set-EntraIDExtensionAttributes.ps1

Populate EntraID computer extensionAttributes for Office, Department, and device type based on a devices location in the OU tree. And, because of the way that Autopilot creates objects in EntraID when a device is provisioned, an extension attribute for hybrid-joined or cloud only objects is created as well. 

---

## Functions

- **`Get-ExtensionAttributes`**: 
  - Uses regex patterns to derive values for `Office`, `Department`, and `DeviceType` from an Active Directory computer object's `distinguishedName` property.
- **`Compare-ExtensionAttributes`**:
  - Compares the `extensionAttributes` in EntraID with those generated by `Get-ExtensionAttributes`. If discrepancies are found, the EntraID object's attributes are updated.

---

## Prerequisites

Ensure the following requirements are met before running the script:
- **PowerShell Version**: 5.1 or later.
- **Modules**:
  - `Microsoft.Graph.Authentication`
  - `Microsoft.Graph.Identity.DirectoryManagement`
  - `ActiveDirectory`

---

## Use-case context

### Introduction

The idea for this script came from someone in the software deployment team who wasn't satisfied with the way dynamic groups were built in Intune. Rather than some kind of real property that marked a device from PDX, we were going off of rules like `(device.deviceName -startsWith "P-") -or (device.deviceName -startsWith "PDX")`. 97% of the time, this was perfectly fine, but there were definitely outliers. After some research, he found that extensionAttributes could be used, and they'd gone unused for device objects on prem up until this point. 

Seems that most powershell scripts seem to start this way, right? A single sentence that perfectly describes how to get to the goal - "Just populate the extension attributes".

### Creating your extensionAttributes

 After talking it over we decided that the three attributes that made the most sense were Office, Department, and device type. The location of a device object in our AD hierarchy would give us all of this info, so it was just a matter of retrieving the data - the `Get-ExtensionAttributes` function.

 Since the `distinguishedname` property contains the path to the object with each of the properties I needed, I had to learn how to actually extract this information and it had to be dynamic. Up until this point, I hadn't really used a switch construct for much of anything (and I've probably only used it once or twice since) but it seemed to be perfect for the job. 
 
 "Here's a list of offices, if you see one of these, that's the device's office."

 Now that I've created a way to pull the data I wanted, I figured the next (and last) step would be using `Set-ADComputer` to set the extensionAttributes on the on prem computer object and Entra Connect would take care of the rest. We just needed to tick off the box in the wizard, force a sync, and we'd be changing our dynamic groups in no time. ðŸ™ƒ "Just populate the extension attributes".

 ### Fine. We'll take the long way around.

 